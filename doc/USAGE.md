# GenUI Usage

This guidance explains how to enable GenUI for your
[Flutter project](https://docs.flutter.dev/reference/create-new-app).

## Hello World

This section describes how to build a minimal
GenUI interaction.

### Configure Firebase

1. [Create a new Firebase project](https://support.google.com/appsheet/answer/10104995) with Firebase Console.

1. [Enable Gemini](https://firebase.google.com/docs/gemini-in-firebase/set-up-gemini)
for the project.

1. Follow [the steps](https://firebase.google.com/docs/flutter/setup)
to configure your Flutter project.

    NOTE: see how secure it is to publish the generated files
    [here](https://firebase.google.com/docs/projects/learn-more#config-files-objects).

1. If you run your Flutter project on the `ios` or `macos` platform, add this key to your
`{ios,macos}/Runner/*.entitlements` file(s):

  ```xml
  <dict>
    ...
    <key>com.apple.security.network.client</key>
    <true/>
  </dict>
  ```

### Integrate `flutter_genui`

For a complete example, refer to [main.dart in the minimal_genui example](../examples/minimal_genui/lib/main.dart). The following steps outline the details:

1. In your `pubspec.yaml` file, add `flutter_genui` to the `dependencies` section with one of the following options:

    * Reference the github project directly:

      ```
        flutter_genui:
          git:
            url: https://github.com/flutter/genui.git
            path: pkgs/flutter_genui
      ```

     * Future: download from pub.dev!

1. Invoke `Firebase.initializeApp` before `runApp`:

    ```dart
    WidgetsFlutterBinding.ensureInitialized();
    await Firebase.initializeApp(options: DefaultFirebaseOptions.currentPlatform);
    ```

1. Construct `GenUiManager` as a state member in a widget where
you want the generated user interface to render.

1. Update the `build` method of the widget to integrate with the UI.
    - **If you are building a new app, or want to try out Gen UI quickly**, use our prebuilt chat widget which includes a chat input box and conversation area. Add code like the following to your `build` method:
    ```dart
    GenUiChat(genUiManager: genUiManager);
    ```

    - **If you have an existing LLM chat UI**, you can update it to integrate rendering of Gen UI "surfaces" and trigger LLM inferences via chat.

        1. In the event handler for your chat input box, call `genUiManager.sendUserPrompt(text)`.

        1. In the `build()` function for your conversation area, use a `StreamBuilder` to rebuild the conversation with the latest conversation content e.g.

        ```dart
        StreamBuilder<List<ChatMessage>>(
          stream: genUiManager.uiUpdates,
          initialData: const <ChatMessage>[],
          builder: (context, snapshot) {
            // ...
          }
        )
        ```

        1. Inside the `StreamBuilder`, handle the different types of messages that can now exist in the Gen UI conversation. Use the implementation in `chat_widget.dart` as a reference. You must use the `SurfaceWidget` in `flutter_genui` to render messages of type `UiResponseMessage`. These are Gen UI components of the conversation.
        ```dart
        switch (message) {
          case UserMessage():
            if (userPromptBuilder != null) {
              return userPromptBuilder!(context, message);
            }
            final text = message.parts
                .whereType<TextPart>()
                .map<String>((part) => part.text)
                .join('\n');
            if (text.trim().isEmpty) {
              return const SizedBox.shrink();
            }
            return MyChatMessageWidget(
              text: text,
              icon: Icons.person,
              alignment: MainAxisAlignment.end,
            );

          case UiResponseMessage():
            return Padding(
              padding: const EdgeInsets.all(16.0),
              child: SurfaceWidget(
                key: message.uiKey,
                response: message,
                host: genUiManager,
              ),
            );
          case _:
            return const SizedBox.shrink();
        }
        ```

1. Start your application and verify that after the prompt is submitted,
the widget, generated by `_genUiManager`, renders the AI response.

## Enhance to GenUI Application

Get inspired by our examples. The `minimal_genui` example is a great starting point.
You can find other examples under development in the `examples/` directory.
Most will require you to [Configure Firebase](#configure-firebase) first.

Then apply what you learned to your app.

If something is unclear or missing, create an issue [here](https://github.com/flutter/genui/issues).
