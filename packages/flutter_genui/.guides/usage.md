# Usage of `flutter_genui`

`flutter_genui` is a Flutter library that enables developers to easily add
interactive generative UI to their applications.

## Key components

- **`GenUiConversation`**: The main entry point of the package. It manages the
  conversation with the LLM, handles UI state, and orchestrates the interaction
  between the app, its UI, and the AI.

- **`ContentGenerator`**: An abstract interface for a client that manages communication with your LLM.
  Implementations are provided in separate packages:
    - `flutter_genui_firebase_ai`: Includes `FirebaseAiContentGenerator` to communicate with Google's Gemini
      models using Firebase Vertex AI.
    - `flutter_genui_a2ui`: Includes `A2uiContentGenerator` to connect to any server
      implementing the [A2UI Streaming UI Protocol](https://a2ui.org).
  You can also create your own subclasses for other models or LLM libraries.

- **`GenUiSurface`**: A Flutter widget that displays UI generated by the agent.
  It listens for updates from the `GenUiManager` (via `GenUiConversation`) and dynamically renders the generated
  UI.

- **`Catalog`**: A catalog of Flutter widgets that the AI is allowed to
  generate. For each widget, you define a name, a schema that describes the data
  needed by the widget, and a builder function. The built-in `CoreCatalogItems`
  include widgets for rendering text, markdown, images, buttons, layouts, and more.

- **`GenUiManager`**: The core state manager for generated UI. You won't often
  interact directly with this class when using `GenUiConversation`, but it's responsible for managing the flow
  of information and events between the agent and your UI.

## Use cases

- Incorporate graphical UI into chatbots: instead of describing a list of products in text,
  the LLM can render an interactive carousel of product widgets. Instead of asking for a user to
  type out answers to questions, the LLM can render sliders, checkboxes, and more.
- Create dynamically composed UIs: an agent can generate a complete form with sliders, date pickers,
  and text fields on the fly based on a user's request to "book a flight."

## Example

This example shows the basic structure of using `GenUiConversation`.
See the `connect_to_agent_provider.md` guide for more details on setting up the `ContentGenerator`.

```dart
import 'package:flutter/material.dart';
import 'package:flutter_genui/flutter_genui.dart';
// Import your chosen ContentGenerator implementation
// import 'package:flutter_genui_firebase_ai/flutter_genui_firebase_ai.dart';
// import 'package:flutter_genui_a2ui/flutter_genui_a2ui.dart';

class MyGenUiPage extends StatefulWidget {
  @override
  _MyGenUiPageState createState() => _MyGenUiPageState();
}

class _MyGenUiPageState extends State<MyGenUiPage> {
  late final GenUiManager _genUiManager;
  late final GenUiConversation _genUiConversation;
  final _surfaceIds = <String>[];

  // Replace with your actual ContentGenerator instance
  ContentGenerator _createContentGenerator() {
    // Example using a placeholder - replace this!
    return YourContentGenerator();
  }

  @override
  void initState() {
    super.initState();
    final catalog = CoreCatalogItems.asCatalog(); // Start with core widgets
    _genUiManager = GenUiManager(catalog: catalog);
    final contentGenerator = _createContentGenerator();

    _genUiConversation = GenUiConversation(
      genUiManager: _genUiManager,
      contentGenerator: contentGenerator,
      onSurfaceAdded: (update) {
        if (!mounted) return;
        setState(() => _surfaceIds.add(update.surfaceId));
      },
      onSurfaceDeleted: (update) {
        if (!mounted) return;
        setState(() => _surfaceIds.remove(update.surfaceId));
      },
      // Other callbacks like onSurfaceUpdated, onTextResponse, onError...
    );
  }

  @override
  void dispose() {
    _genUiConversation.dispose();
    super.dispose();
  }

  void _sendMessage(String text) {
    if (text.trim().isEmpty) return;
    _genUiConversation.sendRequest(UserMessage.text(text));
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('GenUI Example')),
      body: Column(
        children: [
          Expanded(
            child: ListView.builder(
              itemCount: _surfaceIds.length,
              itemBuilder: (context, index) {
                final id = _surfaceIds[index];
                return GenUiSurface(host: _genUiConversation.host, surfaceId: id);
              },
            ),
          ),
          // Input area for sending messages
          Padding(
            padding: const EdgeInsets.all(8.0),
            child: Row(
              children: [
                Expanded(
                  child: TextField(
                    onSubmitted: _sendMessage,
                    decoration: InputDecoration(hintText: 'Enter message...'),
                  ),
                ),
                IconButton(
                  icon: Icon(Icons.send),
                  onPressed: () { /* Extract text and call _sendMessage */ },
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }
}

// Placeholder for your ContentGenerator implementation
class YourContentGenerator implements ContentGenerator {
  @override
  Stream<A2uiMessage> get a2uiMessageStream => Stream.empty();
  @override
  Stream<String> get textResponseStream => Stream.empty();
  @override
  Stream<ContentGeneratorError> get errorStream => Stream.empty();
  @override
  ValueListenable<bool> get isProcessing => ValueNotifier(false);
  @override
  Future<void> sendRequest(ChatMessage message, {Iterable<ChatMessage>? history}) async {}
  @override
  void dispose() {}
}
```
